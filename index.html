<style>
:root {
  --bg:#e5ddd5;
  --panel:#ffffff;
  --accent:#25D366;
  --me:#daf8cb;
  --them:#ffffff;
  --muted:#999;
}

/* ===== Bot√£o flutuante ===== */
#chatbot-toggle{
  position:fixed;
  bottom:20px;
  right:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:#25D366;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  z-index:10000;
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
  transition:all 0.3s ease;
}
#chatbot-toggle img{width:28px;height:28px}

/* ===== Texto flutuante ===== */
#chatbot-hint{
  position:fixed;
  bottom:90px;
  right:20px;
  background:#fff;
  color:#333;
  font-size:14px;
  padding:8px 12px;
  border-radius:8px;
  box-shadow:0 4px 8px rgba(0,0,0,0.15);
  max-width:220px;
  font-family:Segoe UI, Roboto, Arial, sans-serif;
  z-index:10000;
  opacity:0;
  animation:fadeIn 1s ease forwards, pulse 2s infinite 1.5s;
}
#chatbot-hint::after{
  content:"";
  position:absolute;
  bottom:-8px;
  right:24px;
  border-width:8px;
  border-style:solid;
  border-color:#fff transparent transparent transparent;
}

/* Anima√ß√µes */
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}

/* ===== Janela do Chatbot ===== */
.chatbot-wrapper{
  position:fixed;
  bottom:90px;
  right:20px;
  width:360px;
  height:640px;
  display:none;
  z-index:10001;
}
.chat-container{
  width:100%;
  height:100%;
  background:linear-gradient(#f6f6f6,#efefef);
  box-shadow:0 10px 30px rgba(0,0,0,0.15);
  border-radius:12px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  font-family:Segoe UI, Roboto, Arial, sans-serif
}
.header{height:72px;background:linear-gradient(90deg,#075E54,#128C7E);color:#fff;padding:12px;display:flex;align-items:center;gap:12px;flex-shrink:0}
.header .avatar{width:48px;height:48px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;color:#128C7E;flex-shrink:0}
.header .title{font-weight:600}
.header .sub{font-size:12px;color:rgba(255,255,255,0.9)}
.messages{flex:1;padding:16px;display:flex;flex-direction:column;gap:10px;overflow:auto;background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><rect width="20" height="20" fill="%23e5ddd5"/></svg>')}
.msg{max-width:78%;padding:10px 12px;border-radius:10px;box-shadow:0 1px 0 rgba(0,0,0,0.06);word-break:break-word;opacity:0;transform:translateY(8px);animation:pop .18s forwards}
.msg.me{align-self:flex-end;background:var(--me);border-bottom-right-radius:2px}
.msg.bot{align-self:flex-start;background:var(--them);border-bottom-left-radius:2px}
@keyframes pop{to{opacity:1;transform:none}}
.typing{display:flex;gap:4px;align-items:center;padding:6px 10px;border-radius:10px;background:var(--them);max-width:40%}
.typing .dot{width:6px;height:6px;border-radius:50%;background:#999;animation:blink 1s infinite}
.typing .dot:nth-child(2){animation-delay:.15s}
.typing .dot:nth-child(3){animation-delay:.3s}
@keyframes blink{0%{opacity:.2}50%{opacity:1}100%{opacity:.2}}
.suggestions{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
.suggestion{background:#fff;padding:6px 10px;border-radius:18px;border:1px solid #e6e6e6;cursor:pointer;font-size:13px;}

/* A MUDAN√áA PRINCIPAL EST√Å AQUI: a √°rea de input foi escondida */
.input-area {display: none;}

</style>
</head>
<body>

<div id="chatbot-toggle" aria-label="Abrir Chatbot">
  <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" alt="Chat" />
</div>
<div id="chatbot-hint">Clique aqui para tirar d√∫vidas das elei√ß√µes</div>
<div class="chatbot-wrapper" id="chatbot-wrapper" role="dialog" aria-label="Chatbot UEMASUL">
  <div class="chat-container" id="chat">
    <div class="header">
      <div class="avatar">
        <img src="http://www.uemasul.edu.br/wp-content/uploads/2019/11/uemasul_brasao_colorido-261x300.png" alt="UEMASUL" style="width:70%;height:auto;">
      </div>
      <div style="flex:1;min-width:0">
        <div class="title">Elei√ß√µes 2025 - Dire√ß√£o de Curso</div>
        <div class="sub">Online ‚Ä¢ √öltima vez agora</div>
      </div>
    </div>
    <div id="messages" class="messages" role="log" aria-live="polite"></div>
    <div class="input-area">
      <input type="text" id="chat-input" placeholder="Digite sua d√∫vida...">
      <button id="send-btn" aria-label="Enviar Mensagem">
        <svg viewBox="0 0 24 24"><path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
      </button>
    </div>
  </div>
</div>

<script>
(function(){
  const wrapper = document.getElementById('chatbot-wrapper');
  const toggle = document.getElementById('chatbot-toggle');
  const hint = document.getElementById('chatbot-hint');
  const messagesEl = document.getElementById('messages');

  // ===== BASE DE CONHECIMENTO (FLEX√çVEL) =====
  // A estrutura continua a mesma. Adicione ou edite itens aqui.
  // O campo 'keywords' n√£o √© mais usado para busca, mas pode ser mantido para refer√™ncia.
  const knowledgeBase = [
    {
      id: 'inicio',
      question: 'Menu Principal',
      answer: 'üëã Ol√°! Sou o assistente virtual da UEMASUL para as elei√ß√µes de Dire√ß√£o de Curso. Por favor, escolha uma das op√ß√µes abaixo para come√ßar.',
      keywords: ['oi', 'ola', 'ol√°', 'inicio', 'menu', 'come√ßar'],
      suggestions: ['eleicoes', 'candidatos', 'prazos']
    },
    {
      id: 'eleicoes',
      question: 'Sobre as elei√ß√µes',
      answer: 'As elei√ß√µes para Dire√ß√£o de Curso seguem o regulamento da UEMASUL e ocorrer√£o em 2025. Sobre o que voc√™ gostaria de saber?',
      keywords: ['elei√ß√£o', 'elei√ß√µes', 'geral', 'sobre'],
      suggestions: ['prazos', 'documentacao', 'elegibilidade', 'candidatos']
    },
    {
      id: 'candidatos',
      question: 'Candidatos',
      answer: 'A lista oficial de candidatos √© publicada pela comiss√£o eleitoral ap√≥s o per√≠odo de inscri√ß√£o. Deseja ver os crit√©rios para se inscrever ?',
      keywords: ['candidato', 'candidatos', 'lista'],
      suggestions: ['inscricao', 'elegibilidade']
    },
    {
      id: 'elegibilidade',
      question: 'Elegibilidade',
      answer: 'Os crit√©rios de elegibilidade ainda n√£o foram informados oficialmente pela comiss√£o eleitoral. Fique atento aos comunicados oficiais.',
      keywords: ['elegibilidade', 'eleg√≠vel', 'quem pode'],
      suggestions: ['prazos', 'comissao', 'inicio']
    },
    {
      id: 'impugnacao',
      question: 'Impugna√ß√£o',
      answer: 'A impugna√ß√£o de candidatura deve ser formalizada por escrito e entregue √† comiss√£o eleitoral, com as devidas provas e dentro do prazo estabelecido no edital.',
      keywords: ['impugna√ß√£o', 'impugnar', 'recurso', 'contestar'],
      suggestions: ['prazos', 'comissao']
    },
    {
      id: 'prazos',
      question: 'Prazos',
      answer: 'Os prazos espec√≠ficos (inscri√ß√£o, recurso, vota√ß√£o) s√£o definidos no edital de cada elei√ß√£o. Recomendo verificar o site institucional ou a secretaria do seu curso para o edital mais recente.',
      keywords: ['prazo', 'prazos', 'data', 'datas', 'quando'],
      suggestions: ['documentacao', 'inscricao', 'inicio']
    },
    {
      id: 'documentacao',
      question: 'Documenta√ß√£o',
      answer: 'Os documentos comumente solicitados s√£o: requerimento de inscri√ß√£o, c√≥pias de RG e CPF, comprovante de v√≠nculo com a institui√ß√£o e, quando exigido, um plano de trabalho.',
      keywords: ['documento', 'documentos', 'documenta√ß√£o', 'papel'],
      suggestions: ['inscricao', 'inicio']
    },
    {
      id: 'inscricao',
      question: 'Como me inscrever?',
      answer: 'Para se inscrever, voc√™ deve ler atentamente o edital, preencher o formul√°rio de inscri√ß√£o e entregar todos os documentos exigidos dentro do prazo na secretaria do seu curso ou local indicado.',
      keywords: ['inscri√ß√£o', 'inscrever', 'me inscrever'],
      suggestions: ['prazos', 'documentacao']
    },
    {
      id: 'comissao',
      question: 'Comiss√£o Eleitoral',
      answer: 'A Comiss√£o Eleitoral √© a respons√°vel por organizar e fiscalizar todo o processo. O contato e a sala da comiss√£o s√£o divulgados no edital de abertura das elei√ß√µes.',
      keywords: ['comiss√£o', 'comissao'],
      suggestions: ['inicio']
    },
    {
      id: 'sair',
      question: 'Sair',
      answer: 'Obrigado por usar o ChatBot UEMASUL! At√© logo üëã',
      keywords: ['sair', 'tchau', 'encerrar', 'xau'],
      suggestions: []
    }
    
  ];

  // ===== L√ìGICA DO CHATBOT (SIMPLIFICADA) =====

  toggle.addEventListener('click', () => {
    const isOpen = wrapper.style.display === 'flex';
    wrapper.style.display = isOpen ? 'none' : 'flex';
    hint.style.display = isOpen ? 'block' : 'none';

    if (!isOpen) {
      resetChat();
    }
  });

  function resetChat() {
    messagesEl.innerHTML = ""; // limpa o hist√≥rico
    const initialResponse = findResponseById('inicio');
    addMessage(initialResponse.answer, 'bot', { suggestions: initialResponse.suggestions });
  }
  
  function findResponseById(id) {
    return knowledgeBase.find(item => item.id === id) || null;
  }

  function addMessage(text, who = 'bot', options = { suggestions: [] }) {
    const msgContainer = document.createElement('div');
    msgContainer.className = 'msg ' + (who === 'me' ? 'me' : 'bot');
    msgContainer.innerHTML = `<div>${escapeHtml(text)}</div>`;
    messagesEl.appendChild(msgContainer);

    // Remove sugest√µes antigas
    const oldSuggestions = messagesEl.querySelector('.suggestions');
    if(oldSuggestions) oldSuggestions.remove();

    if (options.suggestions && options.suggestions.length > 0) {
      const sugWrap = document.createElement('div');
      sugWrap.className = 'suggestions';
      
      const suggestionIds = text.includes("At√© logo") ? [] : [...options.suggestions, 'sair'];

      suggestionIds.forEach(id => {
        const data = findResponseById(id);
        if (data) {
          const b = document.createElement('div');
          b.className = 'suggestion';
          b.textContent = data.question;
          b.onclick = () => handleOption(id);
          sugWrap.appendChild(b);
        }
      });
      messagesEl.appendChild(sugWrap);
    }
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }
  
  // Esta √© agora a √öNICA fun√ß√£o que lida com a intera√ß√£o do usu√°rio
  function handleOption(id) {
    const optionData = findResponseById(id);
    if (!optionData) return;

    // Adiciona a pergunta do bot√£o como se o usu√°rio tivesse falado
    addMessage(optionData.question, 'me'); 
    
    // Mostra a resposta do bot
    showResponse(optionData);
  }
  
  function showResponse(response) {
     const typingEl = showTypingIndicator();

    setTimeout(() => {
      typingEl.remove();
      if (response) {
        if (response.id === 'sair') {
          addMessage(response.answer, 'bot', { suggestions: [] });
          setTimeout(() => { 
            wrapper.style.display = 'none'; 
            hint.style.display = 'block'; 
          }, 2000);
        } else {
          addMessage(response.answer, 'bot', { suggestions: response.suggestions });
        }
      } else {
        // Mensagem de erro caso um ID de sugest√£o n√£o seja encontrado (pouco prov√°vel)
        const notFound = findResponseById('inicio');
        addMessage("Ocorreu um erro. Voltando ao in√≠cio.", 'bot', { suggestions: notFound.suggestions });
      }
    }, 700 + Math.random() * 400);
  }

  function showTypingIndicator() {
    const el = document.createElement('div');
    el.className = 'msg bot';
    el.innerHTML = `<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>`;
    messagesEl.appendChild(el);
    messagesEl.scrollTop = messagesEl.scrollHeight;
    return el;
  }
  
  function escapeHtml(unsafe) {
    return String(unsafe)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // Inicializa o chat quando a p√°gina carrega
  window.addEventListener('load', () => {
    resetChat();
  });
})();
</script>